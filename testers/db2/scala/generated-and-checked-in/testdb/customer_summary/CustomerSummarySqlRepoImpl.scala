/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_summary

import java.sql.Connection
import dev.typr.foundations.scala.Fragment.sql

class CustomerSummarySqlRepoImpl extends CustomerSummarySqlRepo {
  override def apply(using c: Connection): List[CustomerSummarySqlRow] = {
    sql"""-- Customer summary with total orders
    SELECT c.customer_id, c.name, c.email,
           COUNT(o.order_id) as order_count,
           COALESCE(SUM(o.total_amount), 0) as total_spent
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    GROUP BY c.customer_id, c.name, c.email
    """.query(CustomerSummarySqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}