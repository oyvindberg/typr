/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.nullability_test

import dev.typr.foundations.Db2Types
import dev.typr.foundations.kotlin.DeleteBuilder
import dev.typr.foundations.kotlin.Dialect
import dev.typr.foundations.kotlin.Fragment
import dev.typr.foundations.kotlin.KotlinDbTypes
import dev.typr.foundations.kotlin.SelectBuilder
import dev.typr.foundations.kotlin.UpdateBuilder
import dev.typr.foundations.kotlin.nullable
import java.sql.Connection
import java.util.ArrayList
import kotlin.collections.List

class NullabilityTestRepoImpl() : NullabilityTestRepo {
  override fun delete(): DeleteBuilder<NullabilityTestFields, NullabilityTestRow> = DeleteBuilder.of("\"NULLABILITY_TEST\"", NullabilityTestFields.structure, Dialect.DB2)

  override fun insert(
    unsaved: NullabilityTestRow,
    c: Connection
  ): NullabilityTestRow = Fragment.interpolate(Fragment.lit("SELECT \"ID\", \"REQUIRED_COL\", \"OPTIONAL_COL\", \"DEFAULTED_COL\" FROM FINAL TABLE (INSERT INTO \"NULLABILITY_TEST\"(\"ID\", \"REQUIRED_COL\", \"OPTIONAL_COL\", \"DEFAULTED_COL\")\nVALUES ("), Fragment.encode(KotlinDbTypes.Db2Types.integer, unsaved.id), Fragment.lit(", "), Fragment.encode(Db2Types.varchar, unsaved.requiredCol), Fragment.lit(", "), Fragment.encode(Db2Types.varchar.nullable(), unsaved.optionalCol), Fragment.lit(", "), Fragment.encode(Db2Types.varchar.nullable(), unsaved.defaultedCol), Fragment.lit("))\n"))
    .updateReturning(NullabilityTestRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: NullabilityTestRowUnsaved,
    c: Connection
  ): NullabilityTestRow {
    val columns: ArrayList<Fragment> = ArrayList()
    val values: ArrayList<Fragment> = ArrayList()
    columns.add(Fragment.lit("\"ID\""))
    values.add(Fragment.interpolate(Fragment.encode(KotlinDbTypes.Db2Types.integer, unsaved.id), Fragment.lit("")))
    columns.add(Fragment.lit("\"REQUIRED_COL\""))
    values.add(Fragment.interpolate(Fragment.encode(Db2Types.varchar, unsaved.requiredCol), Fragment.lit("")))
    columns.add(Fragment.lit("\"OPTIONAL_COL\""))
    values.add(Fragment.interpolate(Fragment.encode(Db2Types.varchar.nullable(), unsaved.optionalCol), Fragment.lit("")))
    unsaved.defaultedCol.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"DEFAULTED_COL\""))
      values.add(Fragment.interpolate(Fragment.encode(Db2Types.varchar.nullable(), value), Fragment.lit(""))) }
    );
    val q: Fragment = Fragment.interpolate(Fragment.lit("SELECT \"ID\", \"REQUIRED_COL\", \"OPTIONAL_COL\", \"DEFAULTED_COL\" FROM FINAL TABLE (INSERT INTO \"NULLABILITY_TEST\"("), Fragment.comma(columns.toMutableList()), Fragment.lit(")\nVALUES ("), Fragment.comma(values.toMutableList()), Fragment.lit("))\n"))
    return q.updateReturning(NullabilityTestRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<NullabilityTestFields, NullabilityTestRow> = SelectBuilder.of("\"NULLABILITY_TEST\"", NullabilityTestFields.structure, NullabilityTestRow._rowParser, Dialect.DB2)

  override fun selectAll(c: Connection): List<NullabilityTestRow> = Fragment.interpolate(Fragment.lit("select \"ID\", \"REQUIRED_COL\", \"OPTIONAL_COL\", \"DEFAULTED_COL\"\nfrom \"NULLABILITY_TEST\"\n")).query(NullabilityTestRow._rowParser.all()).runUnchecked(c)

  override fun update(): UpdateBuilder<NullabilityTestFields, NullabilityTestRow> = UpdateBuilder.of("\"NULLABILITY_TEST\"", NullabilityTestFields.structure, NullabilityTestRow._rowParser, Dialect.DB2)
}