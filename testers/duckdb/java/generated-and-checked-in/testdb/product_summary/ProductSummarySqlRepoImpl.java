/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.product_summary;

import static dev.typr.foundations.Fragment.interpolate;

import dev.typr.foundations.Fragment;
import java.sql.Connection;
import java.util.List;

public class ProductSummarySqlRepoImpl implements ProductSummarySqlRepo {
  @Override
  public List<ProductSummarySqlRow> apply(Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Product Summary View\n"
                    + "-- Shows product details with aggregated information\n"
                    + "-- This tests DuckDB SQL file processing and view generation\n\n"
                    + "SELECT\n"
                    + "  p.product_id,\n"
                    + "  p.name as product_name,\n"
                    + "  p.sku,\n"
                    + "  p.price,\n"
                    + "  COUNT(*) as order_count,\n"
                    + "  COALESCE(SUM(oi.quantity), 0) as total_quantity,\n"
                    + "  COALESCE(SUM(oi.quantity * oi.unit_price), 0) as total_revenue\n"
                    + "FROM products p\n"
                    + "LEFT JOIN order_items oi ON p.product_id = oi.product_id\n"
                    + "GROUP BY p.product_id, p.name, p.sku, p.price\n"))
        .query(ProductSummarySqlRow._rowParser.all())
        .runUnchecked(c);
  }
}
