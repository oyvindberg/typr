/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.employees_by_department

import dev.typr.foundations.OracleTypes
import dev.typr.foundations.scala.Fragment
import java.sql.Connection
import dev.typr.foundations.scala.Fragment.sql

class EmployeesByDepartmentSqlRepoImpl extends EmployeesByDepartmentSqlRepo {
  override def apply(
    deptCode: String,
    deptRegion: String
  )(using c: Connection): List[EmployeesByDepartmentSqlRow] = {
    sql"""-- Get employees in a department
    SELECT
        e.emp_number,
        e.emp_suffix,
        e.emp_name,
        e.salary,
        e.hire_date,
        d.dept_name,
        d.budget
    FROM employees e
    INNER JOIN departments d ON e.dept_code = d.dept_code AND e.dept_region = d.dept_region
    WHERE e.dept_code = ${Fragment.encode(OracleTypes.varchar2, deptCode)}
      AND e.dept_region = ${Fragment.encode(OracleTypes.varchar2, deptRegion)}
    ORDER BY e.emp_name
    """.query(EmployeesByDepartmentSqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}