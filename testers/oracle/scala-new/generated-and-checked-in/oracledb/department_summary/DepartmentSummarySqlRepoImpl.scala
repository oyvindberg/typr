/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.department_summary

import java.sql.Connection
import dev.typr.foundations.scala.Fragment.sql

class DepartmentSummarySqlRepoImpl extends DepartmentSummarySqlRepo {
  override def apply(using c: Connection): List[DepartmentSummarySqlRow] = {
    sql"""-- Get department summary with employee count
    SELECT
        d.dept_code,
        d.dept_region,
        d.dept_name,
        d.budget,
        COUNT(e.emp_number) as employee_count
    FROM departments d
    LEFT JOIN employees e ON d.dept_code = e.dept_code AND d.dept_region = e.dept_region
    GROUP BY d.dept_code, d.dept_region, d.dept_name, d.budget
    ORDER BY d.dept_code, d.dept_region
    """.query(DepartmentSummarySqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}