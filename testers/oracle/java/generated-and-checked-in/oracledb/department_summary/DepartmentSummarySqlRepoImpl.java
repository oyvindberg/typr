/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.department_summary;

import static dev.typr.foundations.Fragment.interpolate;

import dev.typr.foundations.Fragment;
import java.sql.Connection;
import java.util.List;

public class DepartmentSummarySqlRepoImpl implements DepartmentSummarySqlRepo {
  @Override
  public List<DepartmentSummarySqlRow> apply(Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Get department summary with employee count\n"
                    + "SELECT\n"
                    + "    d.dept_code,\n"
                    + "    d.dept_region,\n"
                    + "    d.dept_name,\n"
                    + "    d.budget,\n"
                    + "    COUNT(e.emp_number) as employee_count\n"
                    + "FROM departments d\n"
                    + "LEFT JOIN employees e ON d.dept_code = e.dept_code AND d.dept_region ="
                    + " e.dept_region\n"
                    + "GROUP BY d.dept_code, d.dept_region, d.dept_name, d.budget\n"
                    + "ORDER BY d.dept_code, d.dept_region\n"))
        .query(DepartmentSummarySqlRow._rowParser.all())
        .runUnchecked(c);
  }
}
