"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9544],{8276:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var s=t(4848),o=t(8453);const i={title:"DSL In-Depth Guide"},r="Typo DSL In-Depth Guide",l={id:"other-features/dsl-in-depth",title:"DSL In-Depth Guide",description:"This guide provides comprehensive coverage of Typo's SQL DSL, including all its features and practical examples.",source:"@site/docs/other-features/dsl-in-depth.md",sourceDirName:"other-features",slug:"/other-features/dsl-in-depth",permalink:"/docs/other-features/dsl-in-depth",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"DSL In-Depth Guide"},sidebar:"tutorialSidebar",previous:{title:"Testing with random values",permalink:"/docs/other-features/testing-with-random-values"},next:{title:"Streaming inserts with COPY API",permalink:"/docs/other-features/streaming-inserts"}},d={},c=[{value:"Basic Selects",id:"basic-selects",level:2},{value:"Where Clauses",id:"where-clauses",level:2},{value:"String Operations",id:"string-operations",level:3},{value:"Null Handling",id:"null-handling",level:3},{value:"Order By",id:"order-by",level:2},{value:"Joins",id:"joins",level:2},{value:"Inner Joins",id:"inner-joins",level:3},{value:"Left Joins",id:"left-joins",level:3},{value:"Multiple Joins",id:"multiple-joins",level:3},{value:"Foreign Key Joins",id:"foreign-key-joins",level:3},{value:"Handling Optionality in Left Joins",id:"handling-optionality-in-left-joins",level:3},{value:"Tuple Syntax with ~",id:"tuple-syntax-with-",level:2},{value:"Printing SQL",id:"printing-sql",level:2},{value:"Limit and Offset",id:"limit-and-offset",level:2},{value:"Update DSL",id:"update-dsl",level:2},{value:"Delete DSL",id:"delete-dsl",level:2},{value:"Type Safety Features",id:"type-safety-features",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"When to Use SQL Files",id:"when-to-use-sql-files",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"typo-dsl-in-depth-guide",children:"Typo DSL In-Depth Guide"}),"\n",(0,s.jsx)(n.p,{children:"This guide provides comprehensive coverage of Typo's SQL DSL, including all its features and practical examples."}),"\n",(0,s.jsx)(n.h2,{id:"basic-selects",children:"Basic Selects"}),"\n",(0,s.jsxs)(n.p,{children:["The DSL provides a type-safe way to query your database. Every repository has a ",(0,s.jsx)(n.code,{children:"select"})," method that returns a ",(0,s.jsx)(n.code,{children:"SelectBuilder"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Simple select all\nval allProducts: List[ProductRow] = productRepo.select.toList\n\n// Select specific rows\nval product: Option[ProductRow] = productRepo.selectById(ProductId(1))\n\n// Select by multiple IDs\nval products: List[ProductRow] = productRepo.selectByIds(Array(ProductId(1), ProductId(2)))\n"})}),"\n",(0,s.jsx)(n.h2,{id:"where-clauses",children:"Where Clauses"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"where"})," method allows you to filter results using type-safe predicates."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Consecutive calls to ",(0,s.jsx)(n.code,{children:"where"}),", ",(0,s.jsx)(n.code,{children:"orderBy"}),", and other query methods create an implicit ",(0,s.jsx)(n.strong,{children:"AND"})," operation. Multiple ",(0,s.jsx)(n.code,{children:"where"})," clauses are combined with AND logic, and multiple ",(0,s.jsx)(n.code,{children:"orderBy"})," clauses create a compound sort order."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// Simple equality\nproductRepo.select\n  .where(_.name === Name("Mountain Bike"))\n  .toList\n\n// Multiple conditions (implicitly ANDed)\nproductRepo.select\n  .where(_.color === Some("Red"))\n  .where(_.listprice > BigDecimal(1000))\n  .where(_.daystomanufacture >= 5)\n  .toList\n\n// OR conditions\nproductRepo.select\n  .where(p => (p.color === Some("Red")).or(p.color === Some("Blue")))\n  .toList\n\n// Complex predicates\nproductRepo.select\n  .where(p => p.listprice > BigDecimal(100) and p.listprice < BigDecimal(500))\n  .where(_.name.like("Mountain%"))\n  .where(_.discontinueddate.isNull)\n  .toList\n\n// IN clause with arrays\nproductRepo.select\n  .where(p => p.productid.in(Array(ProductId(1), ProductId(22))))\n  .toList\n\n// Complex boolean logic\nproductRepo.select\n  .where(x => (x.daystomanufacture > 25).or(x.daystomanufacture <= 0))\n  .toList\n'})}),"\n",(0,s.jsx)(n.h3,{id:"string-operations",children:"String Operations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// LIKE patterns\nproductRepo.select.where(_.name.like("Mountain%"))\nproductRepo.select.where(_.name.like("%Bike%"))\n\n// NOT LIKE\nproductRepo.select.where(p => !p.name.like("Road%"))\n\n// String length\nproductRepo.select.where(_.name.strLength > 10)\n\n// String concatenation\nproductRepo.select.where(p => (p.name.underlying || " - " || p.productnumber).like("%Special%"))\n'})}),"\n",(0,s.jsx)(n.h3,{id:"null-handling",children:"Null Handling"}),"\n",(0,s.jsx)(n.p,{children:"The DSL tracks nullability through the type system:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// Check for NULL\nproductRepo.select.where(_.color.isNull)\nproductRepo.select.where(p => !p.color.isNull)\n\n// COALESCE\nproductRepo.select.where(p => p.color.coalesce("Unknown") === "Red")\n\n// Working with non-nullable fields\nproductRepo.select.where(_.makeflag === Flag(true))\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": There's also a ",(0,s.jsx)(n.code,{children:"whereStrict"})," variant that requires non-nullable predicates. This can be useful when you want to ensure at compile time that your predicate cannot be null, which helps when dealing with PostgreSQL's nullability semantics. Use regular ",(0,s.jsx)(n.code,{children:"where"})," for most cases."]}),"\n",(0,s.jsx)(n.h2,{id:"order-by",children:"Order By"}),"\n",(0,s.jsxs)(n.p,{children:["Sort results using the ",(0,s.jsx)(n.code,{children:"orderBy"})," method:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Simple ordering\nproductRepo.select\n  .orderBy(_.name.asc)\n  .toList\n\n// Multiple sort criteria\nproductRepo.select\n  .orderBy(_.listprice.desc)\n  .orderBy(_.name.asc)\n  .toList\n\n// With null handling\nproductRepo.select\n  .orderBy(_.color.desc.withNullsFirst)\n  .orderBy(_.modifieddate.asc.withNullsFirst)\n  .toList\n"})}),"\n",(0,s.jsx)(n.h2,{id:"joins",children:"Joins"}),"\n",(0,s.jsx)(n.p,{children:"Typo supports various join types with type-safe predicates."}),"\n",(0,s.jsx)(n.h3,{id:"inner-joins",children:"Inner Joins"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Simple inner join\nval joinedData = productRepo.select\n  .join(unitmeasureRepo.select)\n  .on { case (product, unitmeasure) => \n    product.sizeunitmeasurecode === unitmeasure.unitmeasurecode \n  }\n  .toList\n"})}),"\n",(0,s.jsx)(n.h3,{id:"left-joins",children:"Left Joins"}),"\n",(0,s.jsxs)(n.p,{children:["Left joins return ",(0,s.jsx)(n.code,{children:"Option[Row]"})," for the right side:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// Left join - note the Option type for the right side\nval leftJoined: List[(ProductRow, Option[ProductmodelRow])] = \n  productRepo.select\n    .join(productmodelRepo.select)\n    .leftOn { case (product, productmodel) => \n      product.productmodelid === productmodel.productmodelid \n    }\n    .toList\n\n// Accessing fields from the optional side\nleftJoined.foreach { case (product, maybeModel) =>\n  println(s"Product: ${product.name}")\n  maybeModel.foreach(model => println(s"  Model: ${model.name}"))\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"multiple-joins",children:"Multiple Joins"}),"\n",(0,s.jsx)(n.p,{children:"When performing multiple joins, the result builds up as nested tuples:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Multiple joins create nested tuples: ((a, b), c)\nval multiJoined = productRepo.select\n  .join(productmodelRepo.select)\n  .on { case (p, pm) => p.productmodelid === pm.productmodelid }\n  .join(productsubcategoryRepo.select)\n  .on { case ((p, _), ps) => p.productsubcategoryid === ps.productsubcategoryid }\n  .join(productcategoryRepo.select)\n  .on { case (((_, _), ps), pc) => ps.productcategoryid === pc.productcategoryid }\n  .toList\n"})}),"\n",(0,s.jsx)(n.h3,{id:"foreign-key-joins",children:"Foreign Key Joins"}),"\n",(0,s.jsxs)(n.p,{children:["Typo provides a convenient ",(0,s.jsx)(n.code,{children:"joinFk"})," method that leverages foreign key relationships:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Using foreign key relationships\nval fkJoined = productRepo.select\n  .joinFk(_.fkProductmodel)(productmodelRepo.select)\n  .joinFk(_._1.fkProductsubcategory)(productsubcategoryRepo.select)\n  .joinFk(_._2.fkProductcategory)(productcategoryRepo.select)\n  .toList\n"})}),"\n",(0,s.jsx)(n.h3,{id:"handling-optionality-in-left-joins",children:"Handling Optionality in Left Joins"}),"\n",(0,s.jsx)(n.p,{children:"When working with left joins, you can access fields from the optional side using a special syntax:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"val leftJoinWithFilter = productRepo.select\n  .join(productmodelRepo.select)\n  .leftOn { case (p, pm) => p.productmodelid === pm.productmodelid }\n  .where { case (product, productModel) => \n    // Use the apply method to safely access optional fields\n    productModel(_.productmodelid) === product.productmodelid\n  }\n  .orderBy { case (_, productModel) => \n    // Optional ordering\n    productModel(_.name).desc.withNullsFirst \n  }\n  .toList\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tuple-syntax-with-",children:"Tuple Syntax with ~"}),"\n",(0,s.jsxs)(n.p,{children:["Typo provides an alternative syntax for working with tuples using the ",(0,s.jsx)(n.code,{children:"~"})," operator:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// Instead of nested tuples ((a, b), c), you can use a ~ b ~ c\nval query = productRepo.select\n  .join(productmodelRepo.select)\n  .on { case (p, pm) => p.productmodelid === pm.productmodelid }\n  .join(productsubcategoryRepo.select)\n  .on { case (p ~ pm, ps) => p.productsubcategoryid === ps.productsubcategoryid }\n  .toList\n\n// Pattern matching with ~\nquery.foreach {\n  case product ~ productModel ~ productSubcategory =>\n    println(s"${product.name} - ${productModel.name} - ${productSubcategory.name}")\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"printing-sql",children:"Printing SQL"}),"\n",(0,s.jsx)(n.p,{children:"You can inspect the generated SQL for any query:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"val query = productRepo.select\n  .where(_.listprice > BigDecimal(100))\n  .join(productmodelRepo.select)\n  .on { case (p, pm) => p.productmodelid === pm.productmodelid }\n  .orderBy { case (p, _) => p.name.asc }\n\n// Print the SQL that will be executed\nquery.sql.foreach(println)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"limit-and-offset",children:"Limit and Offset"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Get first 10 products\nproductRepo.select\n  .orderBy(_.name.asc)\n  .limit(10)\n  .toList\n\n// Pagination\nproductRepo.select\n  .orderBy(_.productid.asc)\n  .offset(20)\n  .limit(10)\n  .toList\n"})}),"\n",(0,s.jsx)(n.h2,{id:"update-dsl",children:"Update DSL"}),"\n",(0,s.jsxs)(n.p,{children:["The update DSL allows batch updates with type-safe predicates. Like other DSL operations, multiple calls to ",(0,s.jsx)(n.code,{children:"setValue"}),", ",(0,s.jsx)(n.code,{children:"setComputedValue"}),", and ",(0,s.jsx)(n.code,{children:"where"})," methods are combined together - all set operations are applied to the same UPDATE statement, and multiple where clauses are ANDed together."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:'// Simple update\nval updated = productRepo.update\n  .setValue(_.listprice)(BigDecimal(99.99))\n  .setValue(_.modifieddate)(TypoLocalDateTime.now)\n  .where(_.productid === ProductId(1))\n  .execute()\n\n// Update with computed values from the column\nproductRepo.update\n  .setComputedValue(_.listprice)(price => price * BigDecimal(1.1)) // 10% increase\n  .setComputedValue(_.reorderpoint)(_ + TypoShort(22))\n  .where(_.productsubcategoryid === Some(ProductsubcategoryId(1)))\n  .execute()\n\n// Complex computed values with string operations\nval update = productRepo.update\n  .setComputedValue(_.name)(p => (p.reverse.upper || Name("flaff")).substring(2, 4))\n  .setValue(_.listprice)(BigDecimal(2))\n  .setComputedValue(_.reorderpoint)(_ + TypoShort(22))\n  .setComputedValue(_.sizeunitmeasurecode)(_ => Some(testUnitmeasure.unitmeasurecode))\n  .where(_.productid === testProduct.productid)\n\n// Return updated rows\nval updatedRows: List[ProductRow] = update.executeReturnChanged()\n\n// Print the SQL that will be executed (with RETURNING clause)\nupdate.sql(returning = true).foreach(println)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"delete-dsl",children:"Delete DSL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-scala",children:"// Delete with predicate\nval deleted = productRepo.delete\n  .where(_.discontinueddate < TypoLocalDateTime.now)\n  .execute()\n\n// Delete by ID\nproductRepo.deleteById(ProductId(1))\n\n// Delete multiple IDs\nproductRepo.deleteByIds(Array(ProductId(1), ProductId(2), ProductId(3)))\n"})}),"\n",(0,s.jsx)(n.h2,{id:"type-safety-features",children:"Type Safety Features"}),"\n",(0,s.jsx)(n.p,{children:"The DSL leverages Scala's type system to prevent common errors:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Column type safety"}),": You can't compare incompatible types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Nullability tracking"}),": The DSL knows which columns are nullable"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Foreign key type safety"}),": ID types prevent joining on wrong columns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Result type inference"}),": The compiler knows the exact shape of your results"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The DSL generates efficient SQL with proper aliasing"}),"\n",(0,s.jsx)(n.li,{children:"Joins are performed at the database level, not in memory"}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"limit"})," for large result sets"]}),"\n",(0,s.jsxs)(n.li,{children:["The generated SQL can be inspected using ",(0,s.jsx)(n.code,{children:".sql"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-sql-files",children:"When to Use SQL Files"}),"\n",(0,s.jsxs)(n.p,{children:['While the DSL is powerful, it\'s designed for the "I just need to fetch/update this data" scenario. Use ',(0,s.jsx)(n.a,{href:"/docs/what-is/sql-is-king",children:"SQL files"})," when you need:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Aggregations (GROUP BY, COUNT, SUM, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"Window functions"}),"\n",(0,s.jsx)(n.li,{children:"CTEs (Common Table Expressions)"}),"\n",(0,s.jsx)(n.li,{children:"Complex subqueries"}),"\n",(0,s.jsx)(n.li,{children:"Database-specific features"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The DSL and SQL files complement each other - use the right tool for each job!"})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var s=t(6540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);