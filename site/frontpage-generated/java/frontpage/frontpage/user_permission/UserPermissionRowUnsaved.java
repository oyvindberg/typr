/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.user_permission;

import com.fasterxml.jackson.annotation.JsonProperty;
import frontpage.customtypes.Defaulted;
import frontpage.customtypes.Defaulted.UseDefault;
import frontpage.customtypes.TypoLocalDateTime;
import frontpage.frontpage.permission.PermissionId;
import frontpage.frontpage.user.UserId;
import java.util.Optional;
import typo.runtime.PgText;

/** This class corresponds to a row in table `frontpage.user_permission` which has not been persisted yet */
public record UserPermissionRowUnsaved(
  /** Points to {@link frontpage.frontpage.user.UserRow#id()} */
  @JsonProperty("user_id") UserId userId,
  /** Points to {@link frontpage.frontpage.permission.PermissionRow#id()} */
  @JsonProperty("permission_id") PermissionId permissionId,
  /** Default: now() */
  @JsonProperty("granted_at") Defaulted<Optional<TypoLocalDateTime>> grantedAt
) {
  public UserPermissionRowUnsaved(
    /** Points to {@link frontpage.frontpage.user.UserRow#id()} */
    @JsonProperty("user_id") UserId userId,
    /** Points to {@link frontpage.frontpage.permission.PermissionRow#id()} */
    @JsonProperty("permission_id") PermissionId permissionId
  ) {
    this(userId, permissionId, new UseDefault<>());
  };

  /** Points to {@link frontpage.frontpage.user.UserRow#id()} */
  public UserPermissionRowUnsaved withUserId(UserId userId) {
    return new UserPermissionRowUnsaved(userId, permissionId, grantedAt);
  };

  /** Points to {@link frontpage.frontpage.permission.PermissionRow#id()} */
  public UserPermissionRowUnsaved withPermissionId(PermissionId permissionId) {
    return new UserPermissionRowUnsaved(userId, permissionId, grantedAt);
  };

  /** Default: now() */
  public UserPermissionRowUnsaved withGrantedAt(Defaulted<Optional<TypoLocalDateTime>> grantedAt) {
    return new UserPermissionRowUnsaved(userId, permissionId, grantedAt);
  };

  static public PgText<UserPermissionRowUnsaved> pgText =
    PgText.instance((row, sb) -> {
      UserId.pgType.pgText().unsafeEncode(row.userId, sb);
      sb.append(PgText.DELIMETER);
      PermissionId.pgType.pgText().unsafeEncode(row.permissionId, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(TypoLocalDateTime.pgType.opt().pgText()).unsafeEncode(row.grantedAt, sb);
    });

  public UserPermissionRow toRow(java.util.function.Supplier<Optional<TypoLocalDateTime>> grantedAtDefault) {
    return new UserPermissionRow(userId, permissionId, grantedAt.getOrElse(grantedAtDefault));
  };
}