/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.employee;

import com.fasterxml.jackson.annotation.JsonProperty;
import frontpage.customtypes.Defaulted;
import frontpage.customtypes.Defaulted.UseDefault;
import frontpage.frontpage.person.PersonId;
import java.math.BigDecimal;
import java.util.Optional;
import typo.runtime.PgText;
import typo.runtime.PgTypes;

/** This class corresponds to a row in table `frontpage.employee` which has not been persisted yet */
public record EmployeeRowUnsaved(
  /** Points to {@link frontpage.frontpage.person.PersonRow#id()} */
  @JsonProperty("person_id") PersonId personId,
  Optional<BigDecimal> salary,
  /** Default: gen_random_uuid() */
  Defaulted<EmployeeId> id
) {
  public EmployeeRowUnsaved(
  
    /** Points to {@link frontpage.frontpage.person.PersonRow#id()} */
    @JsonProperty("person_id") PersonId personId
  ) {
    this(personId, Optional.empty(), new UseDefault<>());
  };

  /** Points to {@link frontpage.frontpage.person.PersonRow#id()} */
  public EmployeeRowUnsaved withPersonId(PersonId personId) {
    return new EmployeeRowUnsaved(personId, salary, id);
  };

  public EmployeeRowUnsaved withSalary(Optional<BigDecimal> salary) {
    return new EmployeeRowUnsaved(personId, salary, id);
  };

  /** Default: gen_random_uuid() */
  public EmployeeRowUnsaved withId(Defaulted<EmployeeId> id) {
    return new EmployeeRowUnsaved(personId, salary, id);
  };

  static public PgText<EmployeeRowUnsaved> pgText =
    PgText.instance((row, sb) -> {
      PersonId.pgType.pgText().unsafeEncode(row.personId, sb);
      sb.append(PgText.DELIMETER);
      PgTypes.numeric.opt().pgText().unsafeEncode(row.salary, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(EmployeeId.pgType.pgText()).unsafeEncode(row.id, sb);
    });

  public EmployeeRow toRow(java.util.function.Supplier<EmployeeId> idDefault) {
    return new EmployeeRow(id.getOrElse(idDefault), personId, salary);
  };
}