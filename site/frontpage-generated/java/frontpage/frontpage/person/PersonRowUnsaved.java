/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.person;

import com.fasterxml.jackson.annotation.JsonProperty;
import frontpage.customtypes.Defaulted;
import frontpage.customtypes.Defaulted.UseDefault;
import frontpage.customtypes.TypoLocalDateTime;
import frontpage.frontpage.address.AddressId;
import java.util.Optional;
import typo.runtime.PgText;
import typo.runtime.PgTypes;

/** This class corresponds to a row in table `frontpage.person` which has not been persisted yet */
public record PersonRowUnsaved(
  String name,
  /** Points to {@link frontpage.frontpage.address.AddressRow#id()} */
  @JsonProperty("address_id") Optional<AddressId> addressId,
  /** Default: gen_random_uuid() */
  Defaulted<PersonId> id,
  /** Default: now() */
  @JsonProperty("created_at") Defaulted<Optional<TypoLocalDateTime>> createdAt
) {
  public PersonRowUnsaved(String name) {
    this(name, Optional.empty(), new UseDefault<>(), new UseDefault<>());
  };

  public PersonRowUnsaved withName(String name) {
    return new PersonRowUnsaved(name, addressId, id, createdAt);
  };

  /** Points to {@link frontpage.frontpage.address.AddressRow#id()} */
  public PersonRowUnsaved withAddressId(Optional<AddressId> addressId) {
    return new PersonRowUnsaved(name, addressId, id, createdAt);
  };

  /** Default: gen_random_uuid() */
  public PersonRowUnsaved withId(Defaulted<PersonId> id) {
    return new PersonRowUnsaved(name, addressId, id, createdAt);
  };

  /** Default: now() */
  public PersonRowUnsaved withCreatedAt(Defaulted<Optional<TypoLocalDateTime>> createdAt) {
    return new PersonRowUnsaved(name, addressId, id, createdAt);
  };

  static public PgText<PersonRowUnsaved> pgText =
    PgText.instance((row, sb) -> {
      PgTypes.text.pgText().unsafeEncode(row.name, sb);
      sb.append(PgText.DELIMETER);
      AddressId.pgType.opt().pgText().unsafeEncode(row.addressId, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(PersonId.pgType.pgText()).unsafeEncode(row.id, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(TypoLocalDateTime.pgType.opt().pgText()).unsafeEncode(row.createdAt, sb);
    });

  public PersonRow toRow(
    java.util.function.Supplier<PersonId> idDefault,
    java.util.function.Supplier<Optional<TypoLocalDateTime>> createdAtDefault
  ) {
    return new PersonRow(id.getOrElse(idDefault), name, addressId, createdAt.getOrElse(createdAtDefault));
  };
}