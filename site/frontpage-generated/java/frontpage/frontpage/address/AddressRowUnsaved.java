/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.address;

import frontpage.customtypes.Defaulted;
import frontpage.customtypes.Defaulted.UseDefault;
import typo.runtime.PgText;
import typo.runtime.PgTypes;

/** This class corresponds to a row in table `frontpage.address` which has not been persisted yet */
public record AddressRowUnsaved(
  String city,
  String country,
  /** Default: gen_random_uuid() */
  Defaulted<AddressId> id
) {
  public AddressRowUnsaved(
    String city,
    String country
  ) {
    this(city, country, new UseDefault<>());
  };

  public AddressRowUnsaved withCity(String city) {
    return new AddressRowUnsaved(city, country, id);
  };

  public AddressRowUnsaved withCountry(String country) {
    return new AddressRowUnsaved(city, country, id);
  };

  /** Default: gen_random_uuid() */
  public AddressRowUnsaved withId(Defaulted<AddressId> id) {
    return new AddressRowUnsaved(city, country, id);
  };

  static public PgText<AddressRowUnsaved> pgText =
    PgText.instance((row, sb) -> {
      PgTypes.text.pgText().unsafeEncode(row.city, sb);
      sb.append(PgText.DELIMETER);
      PgTypes.text.pgText().unsafeEncode(row.country, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(AddressId.pgType.pgText()).unsafeEncode(row.id, sb);
    });

  public AddressRow toRow(java.util.function.Supplier<AddressId> idDefault) {
    return new AddressRow(id.getOrElse(idDefault), city, country);
  };
}