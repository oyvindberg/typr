/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.order

import frontpage.Text
import frontpage.customtypes.Defaulted
import frontpage.customtypes.Defaulted.UseDefault
import frontpage.customtypes.TypoLocalDateTime
import frontpage.frontpage.OrderStatus
import frontpage.frontpage.product.ProductId
import frontpage.frontpage.user.UserId
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** This class corresponds to a row in table `frontpage.order` which has not been persisted yet */
case class OrderRowUnsaved(
  /** Points to [[frontpage.frontpage.user.UserRow.id]] */
  userId: Option[UserId] = None,
  /** Points to [[frontpage.frontpage.product.ProductRow.id]] */
  productId: Option[ProductId] = None,
  total: BigDecimal,
  shippedAt: Option[TypoLocalDateTime] = None,
  /** Default: gen_random_uuid() */
  id: Defaulted[OrderId] = new UseDefault(),
  /** Default: 'pending'::frontpage.order_status */
  status: Defaulted[Option[OrderStatus]] = new UseDefault(),
  /** Default: now() */
  createdAt: Defaulted[Option[TypoLocalDateTime]] = new UseDefault()
) {
  def toRow(
    idDefault: => OrderId,
    statusDefault: => Option[OrderStatus],
    createdAtDefault: => Option[TypoLocalDateTime]
  ): OrderRow = {
    new OrderRow(
      id = id.getOrElse(idDefault),
      userId = userId,
      productId = productId,
      status = status.getOrElse(statusDefault),
      total = total,
      createdAt = createdAt.getOrElse(createdAtDefault),
      shippedAt = shippedAt
    )
  }
}

object OrderRowUnsaved {
  given pgText: Text[OrderRowUnsaved] = {
    Text.instance[OrderRowUnsaved]{ (row, sb) =>
      Text.option(using UserId.pgText).unsafeEncode(row.userId, sb)
      sb.append(Text.DELIMETER)
      Text.option(using ProductId.pgText).unsafeEncode(row.productId, sb)
      sb.append(Text.DELIMETER)
      Text.bigDecimalInstance.unsafeEncode(row.total, sb)
      sb.append(Text.DELIMETER)
      Text.option(using TypoLocalDateTime.pgText).unsafeEncode(row.shippedAt, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using OrderId.pgText).unsafeEncode(row.id, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using OrderStatus.pgText)).unsafeEncode(row.status, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using TypoLocalDateTime.pgText)).unsafeEncode(row.createdAt, sb)
    }
  }

  given reads: Reads[OrderRowUnsaved] = {
    Reads[OrderRowUnsaved](json => JsResult.fromTry(
        Try(
          OrderRowUnsaved(
            userId = json.\("user_id").toOption.map(_.as(UserId.reads)),
            productId = json.\("product_id").toOption.map(_.as(ProductId.reads)),
            total = json.\("total").as(Reads.bigDecReads),
            shippedAt = json.\("shipped_at").toOption.map(_.as(TypoLocalDateTime.reads)),
            id = json.\("id").as(Defaulted.reads(using OrderId.reads)),
            status = json.\("status").as(Defaulted.readsOpt(using OrderStatus.reads)),
            createdAt = json.\("created_at").as(Defaulted.readsOpt(using TypoLocalDateTime.reads))
          )
        )
      ),
    )
  }

  given writes: OWrites[OrderRowUnsaved] = {
    OWrites[OrderRowUnsaved](o =>
      new JsObject(ListMap[String, JsValue](
        "user_id" -> Writes.OptionWrites(using UserId.writes).writes(o.userId),
        "product_id" -> Writes.OptionWrites(using ProductId.writes).writes(o.productId),
        "total" -> Writes.BigDecimalWrites.writes(o.total),
        "shipped_at" -> Writes.OptionWrites(using TypoLocalDateTime.writes).writes(o.shippedAt),
        "id" -> Defaulted.writes(using OrderId.writes).writes(o.id),
        "status" -> Defaulted.writes(using Writes.OptionWrites(using OrderStatus.writes)).writes(o.status),
        "created_at" -> Defaulted.writes(using Writes.OptionWrites(using TypoLocalDateTime.writes)).writes(o.createdAt)
      ))
    )
  }
}