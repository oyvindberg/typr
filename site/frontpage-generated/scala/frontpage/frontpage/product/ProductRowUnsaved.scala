/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.product

import frontpage.Text
import frontpage.customtypes.Defaulted
import frontpage.customtypes.Defaulted.UseDefault
import frontpage.customtypes.TypoJsonb
import frontpage.customtypes.TypoLocalDateTime
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** This class corresponds to a row in table `frontpage.product` which has not been persisted yet */
case class ProductRowUnsaved(
  name: String,
  price: BigDecimal,
  lastRestocked: Option[TypoLocalDateTime] = None,
  /** Default: gen_random_uuid() */
  id: Defaulted[ProductId] = new UseDefault(),
  /** Default: true */
  inStock: Defaulted[Option[Boolean]] = new UseDefault(),
  /** Default: 0 */
  quantity: Defaulted[Option[Int]] = new UseDefault(),
  /** Default: now() */
  lastModified: Defaulted[Option[TypoLocalDateTime]] = new UseDefault(),
  /** Default: '{}'::text[] */
  tags: Defaulted[Option[Array[String]]] = new UseDefault(),
  /** Default: '{}'::integer[] */
  categories: Defaulted[Option[Array[Int]]] = new UseDefault(),
  /** Default: '{}'::numeric[] */
  prices: Defaulted[Option[Array[BigDecimal]]] = new UseDefault(),
  /** Default: '{}'::jsonb[] */
  attributes: Defaulted[Option[Array[TypoJsonb]]] = new UseDefault()
) {
  def toRow(
    idDefault: => ProductId,
    inStockDefault: => Option[Boolean],
    quantityDefault: => Option[Int],
    lastModifiedDefault: => Option[TypoLocalDateTime],
    tagsDefault: => Option[Array[String]],
    categoriesDefault: => Option[Array[Int]],
    pricesDefault: => Option[Array[BigDecimal]],
    attributesDefault: => Option[Array[TypoJsonb]]
  ): ProductRow = {
    new ProductRow(
      id = id.getOrElse(idDefault),
      name = name,
      price = price,
      inStock = inStock.getOrElse(inStockDefault),
      quantity = quantity.getOrElse(quantityDefault),
      lastRestocked = lastRestocked,
      lastModified = lastModified.getOrElse(lastModifiedDefault),
      tags = tags.getOrElse(tagsDefault),
      categories = categories.getOrElse(categoriesDefault),
      prices = prices.getOrElse(pricesDefault),
      attributes = attributes.getOrElse(attributesDefault)
    )
  }
}

object ProductRowUnsaved {
  given pgText: Text[ProductRowUnsaved] = {
    Text.instance[ProductRowUnsaved]{ (row, sb) =>
      Text.stringInstance.unsafeEncode(row.name, sb)
      sb.append(Text.DELIMETER)
      Text.bigDecimalInstance.unsafeEncode(row.price, sb)
      sb.append(Text.DELIMETER)
      Text.option(using TypoLocalDateTime.pgText).unsafeEncode(row.lastRestocked, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using ProductId.pgText).unsafeEncode(row.id, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text.booleanInstance)).unsafeEncode(row.inStock, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text.intInstance)).unsafeEncode(row.quantity, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using TypoLocalDateTime.pgText)).unsafeEncode(row.lastModified, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text[Array[String]])).unsafeEncode(row.tags, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text[Array[Int]])).unsafeEncode(row.categories, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text[Array[BigDecimal]])).unsafeEncode(row.prices, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text.iterableInstance[Array, TypoJsonb](using TypoJsonb.pgText, summon))).unsafeEncode(row.attributes, sb)
    }
  }

  given reads: Reads[ProductRowUnsaved] = {
    Reads[ProductRowUnsaved](json => JsResult.fromTry(
        Try(
          ProductRowUnsaved(
            name = json.\("name").as(Reads.StringReads),
            price = json.\("price").as(Reads.bigDecReads),
            lastRestocked = json.\("last_restocked").toOption.map(_.as(TypoLocalDateTime.reads)),
            id = json.\("id").as(Defaulted.reads(using ProductId.reads)),
            inStock = json.\("in_stock").as(Defaulted.readsOpt(using Reads.BooleanReads)),
            quantity = json.\("quantity").as(Defaulted.readsOpt(using Reads.IntReads)),
            lastModified = json.\("last_modified").as(Defaulted.readsOpt(using TypoLocalDateTime.reads)),
            tags = json.\("tags").as(Defaulted.readsOpt(using Reads.ArrayReads[String](using Reads.StringReads, implicitly))),
            categories = json.\("categories").as(Defaulted.readsOpt(using Reads.ArrayReads[Int](using Reads.IntReads, implicitly))),
            prices = json.\("prices").as(Defaulted.readsOpt(using Reads.ArrayReads[BigDecimal](using Reads.bigDecReads, implicitly))),
            attributes = json.\("attributes").as(Defaulted.readsOpt(using Reads.ArrayReads[TypoJsonb](using TypoJsonb.reads, implicitly)))
          )
        )
      ),
    )
  }

  given writes: OWrites[ProductRowUnsaved] = {
    OWrites[ProductRowUnsaved](o =>
      new JsObject(ListMap[String, JsValue](
        "name" -> Writes.StringWrites.writes(o.name),
        "price" -> Writes.BigDecimalWrites.writes(o.price),
        "last_restocked" -> Writes.OptionWrites(using TypoLocalDateTime.writes).writes(o.lastRestocked),
        "id" -> Defaulted.writes(using ProductId.writes).writes(o.id),
        "in_stock" -> Defaulted.writes(using Writes.OptionWrites(using Writes.BooleanWrites)).writes(o.inStock),
        "quantity" -> Defaulted.writes(using Writes.OptionWrites(using Writes.IntWrites)).writes(o.quantity),
        "last_modified" -> Defaulted.writes(using Writes.OptionWrites(using TypoLocalDateTime.writes)).writes(o.lastModified),
        "tags" -> Defaulted.writes(using Writes.OptionWrites(using Writes.arrayWrites[String](using implicitly, Writes.StringWrites))).writes(o.tags),
        "categories" -> Defaulted.writes(using Writes.OptionWrites(using Writes.arrayWrites[Int](using implicitly, Writes.IntWrites))).writes(o.categories),
        "prices" -> Defaulted.writes(using Writes.OptionWrites(using Writes.arrayWrites[BigDecimal](using implicitly, Writes.BigDecimalWrites))).writes(o.prices),
        "attributes" -> Defaulted.writes(using Writes.OptionWrites(using Writes.arrayWrites[TypoJsonb](using implicitly, TypoJsonb.writes))).writes(o.attributes)
      ))
    )
  }
}