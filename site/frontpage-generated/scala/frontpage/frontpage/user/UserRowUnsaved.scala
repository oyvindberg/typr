/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package frontpage.frontpage.user

import frontpage.Text
import frontpage.customtypes.Defaulted
import frontpage.customtypes.Defaulted.UseDefault
import frontpage.customtypes.TypoLocalDateTime
import frontpage.frontpage.Email
import frontpage.frontpage.UserRole
import frontpage.frontpage.UserStatus
import frontpage.frontpage.department.DepartmentId
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** This class corresponds to a row in table `frontpage.user` which has not been persisted yet */
case class UserRowUnsaved(
  email: Email,
  name: String,
  /** Points to [[frontpage.frontpage.department.DepartmentRow.id]] */
  departmentId: Option[DepartmentId] = None,
  /** Points to [[frontpage.frontpage.user.UserRow.id]] */
  managerId: Option[UserId] = None,
  /** Default: gen_random_uuid() */
  id: Defaulted[UserId] = new UseDefault(),
  /** Default: now() */
  createdAt: Defaulted[Option[TypoLocalDateTime]] = new UseDefault(),
  /** Default: 'active'::frontpage.user_status */
  status: Defaulted[Option[UserStatus]] = new UseDefault(),
  /** Default: false */
  verified: Defaulted[Option[Boolean]] = new UseDefault(),
  /** Default: 'employee'::frontpage.user_role */
  role: Defaulted[Option[UserRole]] = new UseDefault()
) {
  def toRow(
    idDefault: => UserId,
    createdAtDefault: => Option[TypoLocalDateTime],
    statusDefault: => Option[UserStatus],
    verifiedDefault: => Option[Boolean],
    roleDefault: => Option[UserRole]
  ): UserRow = {
    new UserRow(
      id = id.getOrElse(idDefault),
      email = email,
      name = name,
      createdAt = createdAt.getOrElse(createdAtDefault),
      departmentId = departmentId,
      status = status.getOrElse(statusDefault),
      verified = verified.getOrElse(verifiedDefault),
      managerId = managerId,
      role = role.getOrElse(roleDefault)
    )
  }
}

object UserRowUnsaved {
  given pgText: Text[UserRowUnsaved] = {
    Text.instance[UserRowUnsaved]{ (row, sb) =>
      Email.pgText.unsafeEncode(row.email, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.name, sb)
      sb.append(Text.DELIMETER)
      Text.option(using DepartmentId.pgText).unsafeEncode(row.departmentId, sb)
      sb.append(Text.DELIMETER)
      Text.option(using UserId.pgText).unsafeEncode(row.managerId, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using UserId.pgText).unsafeEncode(row.id, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using TypoLocalDateTime.pgText)).unsafeEncode(row.createdAt, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using UserStatus.pgText)).unsafeEncode(row.status, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using Text.booleanInstance)).unsafeEncode(row.verified, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Text.option(using UserRole.pgText)).unsafeEncode(row.role, sb)
    }
  }

  given reads: Reads[UserRowUnsaved] = {
    Reads[UserRowUnsaved](json => JsResult.fromTry(
        Try(
          UserRowUnsaved(
            email = json.\("email").as(Email.reads),
            name = json.\("name").as(Reads.StringReads),
            departmentId = json.\("department_id").toOption.map(_.as(DepartmentId.reads)),
            managerId = json.\("manager_id").toOption.map(_.as(UserId.reads)),
            id = json.\("id").as(Defaulted.reads(using UserId.reads)),
            createdAt = json.\("created_at").as(Defaulted.readsOpt(using TypoLocalDateTime.reads)),
            status = json.\("status").as(Defaulted.readsOpt(using UserStatus.reads)),
            verified = json.\("verified").as(Defaulted.readsOpt(using Reads.BooleanReads)),
            role = json.\("role").as(Defaulted.readsOpt(using UserRole.reads))
          )
        )
      ),
    )
  }

  given writes: OWrites[UserRowUnsaved] = {
    OWrites[UserRowUnsaved](o =>
      new JsObject(ListMap[String, JsValue](
        "email" -> Email.writes.writes(o.email),
        "name" -> Writes.StringWrites.writes(o.name),
        "department_id" -> Writes.OptionWrites(using DepartmentId.writes).writes(o.departmentId),
        "manager_id" -> Writes.OptionWrites(using UserId.writes).writes(o.managerId),
        "id" -> Defaulted.writes(using UserId.writes).writes(o.id),
        "created_at" -> Defaulted.writes(using Writes.OptionWrites(using TypoLocalDateTime.writes)).writes(o.createdAt),
        "status" -> Defaulted.writes(using Writes.OptionWrites(using UserStatus.writes)).writes(o.status),
        "verified" -> Defaulted.writes(using Writes.OptionWrites(using Writes.BooleanWrites)).writes(o.verified),
        "role" -> Defaulted.writes(using Writes.OptionWrites(using UserRole.writes)).writes(o.role)
      ))
    )
  }
}